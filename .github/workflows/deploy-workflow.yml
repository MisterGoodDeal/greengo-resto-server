name: deploy-workflow

on:
  workflow_call:
    inputs:
      sha_to_deploy:
        required: true
        type: string
    secrets:
      app-root:
        required: true
      cpanel-user:
        required: true
      host:
        required: true
      ssh-pk:
        required: true
      ssh-pk-passphrase:
        required: true

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
    - name: Install SSH Key
      uses: shimataro/ssh-key-action@v2
      with:
        key: ${{ secrets.ssh-pk }} 
        known_hosts: ${{ secrets.host }}
    - name: Stop the instance
      uses: appleboy/ssh-action@v0.1.6
      with:
        host: ${{ secrets.host }}
        username: ${{ secrets.cpanel-user }}
        key: ${{ secrets.ssh-pk }}
        passphrase: ${{ secrets.ssh-pk-passphrase }}
        port: 22
        script: whoami
    # - name: Deploy with rsync
    #     run: rsync -avz ./dist/ ${{ secrets.SSH_USER }}@${{ secrets.SSH_HOST }}:/home/zellwk/zellwk.com/dist/